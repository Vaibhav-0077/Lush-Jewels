<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Vaibhav Jewels</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- Header -->
<header class="bg-purple-700 text-white py-5 shadow-md">
  <div class="container mx-auto flex justify-between items-center px-6">
    <h1 class="text-2xl font-bold">ğŸ’ Admin Dashboard</h1>

    <div class="flex items-center gap-3">
      <!-- Add Product Button -->
      <a
        href="/admin/add-product"
        class="bg-yellow-400 text-black px-4 py-2 rounded hover:bg-yellow-500"
      >
        â• Add New Product
      </a>

      <!-- Logout Button -->
      <form onsubmit="event.preventDefault(); confirmLogout();" method="POST">
        <button
          type="submit"
          class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
        >
          ğŸšª Logout
        </button>
      </form>

      <a href="/admin/orders"
          class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
          ğŸ§¾ View Orders
        </a>


    </div>
  </div>
</header>


  <!-- Main Section -->
  <main class="container mx-auto px-6 py-10">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">All Products</h2>

    <% if (products && products.length > 0) { %>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        <% products.forEach(p => { %>
          <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-xl transition duration-300">
            <img src="<%= p.img %>" alt="<%= p.name %>" 
                 class="w-full h-64 object-cover rounded-lg mb-3">
            <h3 class="text-lg font-semibold"><%= p.name %></h3>
            <p class="text-gray-600 mb-1">ğŸ’° <%= p.price %></p>
            <p class="text-gray-500 text-sm mb-2">ğŸ“‚ <%= p.category %></p>

            <form action="/admin/delete/<%= p._id %>" method="POST" 
                  onsubmit="event.preventDefault(); confirmDelete(this);" 
                  class="mt-3">
              <button type="submit" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">
                ğŸ—‘ï¸ Delete
              </button>
            </form>


          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-gray-500 text-center py-10">No products available.</p>
    <% } %>
  </main>


  <!-- Toast Container -->
  <!-- âœ… Toast Container -->
    <!-- âœ… Center Toast Container -->
    <div id="toast-container"
        class="fixed inset-0 flex flex-col items-center justify-center pointer-events-none space-y-3 z-50">
    </div>

  <!-- âœ… Custom Confirmation Modal -->
  <div id="confirm-box" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-80 p-6 text-center">
      <p id="confirm-message" class="text-gray-800 text-lg mb-6">Are you sure?</p>
      <div class="flex justify-center gap-4">
        <button id="confirm-yes" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Yes</button>
        <button id="confirm-no" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded">No</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-center py-4 bg-gray-900 text-white mt-10">
    &copy; 2025 Vaibhav Jewels Admin Panel
  </footer>


  <script>

    //delete button toast msg
  function confirmDelete(form) {
    if (confirm("Delete this product?")) {
      showToast("Product deleted successfully!", "success");
      setTimeout(() => form.submit(), 800);
    } else {
      showToast("Deletion cancelled", "info");
    }
  }

  // ğŸ§  Prevent Back button cache issue (keep your existing code)
  window.addEventListener("pageshow", function (event) {
    if (event.persisted || (performance && performance.navigation.type === 2)) {
      window.location.reload();
    }
  });



  // Toast helper
    /* ================================
     ğŸ”” TOAST SYSTEM
  ================================= */
  function showToast(message, type = "info") {
    const toast = document.createElement("div");
    const colors = {
      success: "bg-green-600",
      error: "bg-red-600",
      info: "bg-blue-600",
      warning: "bg-yellow-500 text-black"
    };

    toast.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg text-lg font-medium
                       transform transition-all duration-500 ease-in-out opacity-0 scale-95`;
    toast.textContent = message;
    toast.style.pointerEvents = "auto"; // allow hover if needed

    const container = document.getElementById("toast-container");
    container.appendChild(toast);

    // Fade in
    setTimeout(() => {
      toast.classList.remove("opacity-0", "scale-95");
    }, 50);

    // Fade out
    setTimeout(() => {
      toast.classList.add("opacity-0", "scale-95");
      setTimeout(() => toast.remove(), 500);
    }, 3000);
  }



  /* ================================
     â“ CONFIRMATION MODAL
  ================================= */
  function showConfirm(message, onConfirm) {
    const modal = document.getElementById("confirm-box");
    const msg = document.getElementById("confirm-message");
    const yes = document.getElementById("confirm-yes");
    const no = document.getElementById("confirm-no");

    msg.textContent = message;
    modal.classList.remove("hidden");

    yes.onclick = () => {
      modal.classList.add("hidden");
      onConfirm(true);
    };
    no.onclick = () => {
      modal.classList.add("hidden");
      onConfirm(false);
    };
  }

  
  //DELETE BUTTON TOAST 
  function confirmDelete(form) {
    showConfirm("Delete this product?", (confirmed) => {
      if (confirmed) {
        showToast("Deleting product...", "warning");
        setTimeout(() => form.submit(), 800);
      } else {
        showToast("Delete cancelled", "info");
      }
    });
  }

  // ğŸ§  Prevent Back button from showing cached dashboard after logout
  window.addEventListener("pageshow", function (event) {
    if (event.persisted || (performance && performance.navigation.type === 2)) {
      window.location.reload();
    }
  });


  //CONFIRM LOGOUT TOAST MESSAGE
  function confirmLogout() {
    showConfirm("Do you really want to log out?", (confirmed) => {
      if (confirmed) {
        showToast("Logging out...", "warning");
        setTimeout(() => {
          const form = document.createElement("form");
          form.method = "POST";
          form.action = "/admin/logout";
          document.body.appendChild(form);
          form.submit();
        }, 800);
      } else {
        showToast("Logout cancelled", "info");
      }
    });
  }

  


</script>


</body>
</html>
